<?xml version="1.0" encoding="UTF-8" ?>
<schema name="topics" version="1.6">
  <fields>
    <field name="id"                    type="string"    indexed="true" stored="true"   multiValued="false" required="true" />
    <field name="id_source"             type="string"    docValues="true" indexed="true" stored="true" multiValued="false" />
    <field name="source_name"           type="string"    docValues="false" indexed="false" stored="true" multiValued="false" />
    <field name="domain"                type="string"    docValues="false" indexed="true" stored="true" multiValued="false" required="true" />
    <field name="id_reference"          type="string"    docValues="true" indexed="true" stored="true" multiValued="false" />
    <field name="id_parent_comment"     type="string"    docValues="false" indexed="true" stored="true" multiValued="false" />
    <field name="identity"              type="string"    docValues="true" indexed="true" stored="true" multiValued="false" />
    <field name="identity_name"         type="string"    docValues="false" indexed="false" stored="true" multiValued="false" />
    <field name="identity_gender"       type="int"       docValues="true" indexed="true" stored="true" multiValued="false" />
    <field name="identity_city"         type="int"       docValues="true" indexed="true" stored="true" multiValued="false" />
    <field name="identity_birthday_year" type="int"      docValues="true" indexed="false" stored="true" multiValued="false" />
    <field name="identity_job_level"    type="int"       docValues="true" indexed="false" stored="true" multiValued="false" />
    <field name="identity_education_level" type="int"    docValues="true" indexed="false" stored="true" multiValued="false" />
    <field name="platform"              type="int"       docValues="true" indexed="true" stored="true" multiValued="false" />
    <field name="mention_type"          type="int"       docValues="true" indexed="true" stored="true" multiValued="false" />
    <field name="mention_type_details"  type="int"       docValues="false" indexed="false" stored="true" multiValued="false" />
    <field name="man_updated_at"        type="date"      docValues="false" indexed="true" stored="true" multiValued="false" />
    <field name="source_type"           type="int"       docValues="true" indexed="true" stored="true" multiValued="false" />
    <field name="source_category"       type="int"       indexed="true" stored="true" multiValued="false" />
    <field name="views"                 type="int"       docValues="true" indexed="false" stored="true" multiValued="false" />
    <field name="likes"                 type="int"       docValues="true" indexed="false" stored="true" multiValued="false" />
    <field name="comments"              type="int"       docValues="true" indexed="false" stored="true" multiValued="false" />
    <field name="shares"                type="int"       docValues="true" indexed="false" stored="true" multiValued="false" />
   <field name="haha"                   type="int"       docValues="true" indexed="false" stored="true" multiValued="false" />
    <field name="sad"                   type="int"       docValues="true" indexed="false" stored="true" multiValued="false" />
    <field name="angry"                 type="int"       docValues="true" indexed="false" stored="true" multiValued="false" />
    <field name="wow"                   type="int"       docValues="true" indexed="false" stored="true" multiValued="false" />
    <field name="heart"                 type="int"       docValues="true" indexed="false" stored="true" multiValued="false" />
    <field name="reaction"              type="int"       docValues="true" indexed="false" stored="true" multiValued="false" />
    <dynamicField name="engage_*"       type="int"       docValues="true" indexed="false" stored="true" multiValued="false" />
    <field name="rating_score"          type="int"       docValues="false" indexed="false" stored="true" multiValued="false" />
    <field name="engagement_total"      type="int"       docValues="true" indexed="false" stored="true" multiValued="false" />
    <field name="engagement_s_c"        type="int"       docValues="true" indexed="false" stored="true" multiValued="false" />
    <field name="title"                 type="text_vi"   indexed="true" stored="true" multiValued="false" />
    <field name="search_text"           type="text_vi"   indexed="true" stored="true" multiValued="true" />
    <field name="search_text_exactly"   type="text_vi_exactly" indexed="true" stored="false" multiValued="true" />
    <field name="sound"                 type="text_vi"   indexed="true" stored="true" multiValued="true" />
    <field name="sound_exactly"         type="text_vi_exactly" indexed="true" stored="false" multiValued="true" />
    <field name="effect"                type="text_vi"   indexed="true" stored="true" multiValued="true" />
    <field name="effect_exactly"        type="text_vi_exactly" indexed="true" stored="false" multiValued="true" />
    <field name="link"                  type="string"    docValues="false" indexed="true" stored="true" multiValued="false" />
    <field name="link_shared"           type="string"    docValues="false" indexed="true" stored="true" multiValued="false" required="false" />
    <field name="link_shared_domain"    type="string"    docValues="false" indexed="false" stored="true" multiValued="false" required="false" />
    <field name="attachment"            type="string"    indexed="false" stored="true" multiValued="false" />
    <field name="sentiment"             type="int"       docValues="true" indexed="true" stored="true" multiValued="false" />
    <field name="categories"            type="int"       docValues="false" indexed="true" stored="true"  multiValued="true"  required="false"/>
    <field name="sentiment_auto"        type="int"       docValues="false" indexed="true" stored="true" multiValued="false" />
    <field name="negative_level"        type="int"       docValues="false" indexed="true" stored="true" multiValued="false" />
    <field name="created_date"          type="date"      docValues="true" indexed="true" stored="true" multiValued="false" />
    <field name="is_noisy"              type="boolean"   docValues="false" indexed="true" stored="true" multiValued="false" />
    <field name="is_ignore"             type="boolean"   docValues="false" indexed="true" stored="true" multiValued="false" />
    <field name="is_relevance"          type="boolean"   docValues="false" indexed="true" stored="true" multiValued="false" default="true" />
    <field name="is_approved"           type="boolean"   docValues="false" indexed="true" stored="true" multiValued="false" />
    <field name="mention_tags"          type="int"       docValues="true" indexed="true" stored="true" multiValued="true" />
    <field name="mention_attributes"    type="int"       docValues="true" indexed="true" stored="true" multiValued="true" />
    <field name="hidden_tags"           type="int"       docValues="false" indexed="true" stored="true" multiValued="true" />
    <field name="competitors"           type="int"       docValues="false" indexed="true" stored="true" multiValued="true" />
    <field name="updated_at"            type="date"      indexed="false" stored="true" multiValued="false" />
    <field name="engagement_date"       type="date"      docValues="false" indexed="true" stored="true" multiValued="false" />
    <field name="copied_at"             type="date"      docValues="false" indexed="true" stored="true" multiValued="false" default="NOW" />
    <field name="last_activity"         type="date"      docValues="true" indexed="false" stored="true" multiValued="false" />
    <field name="last_sentiment"        type="date"      indexed="false" stored="true" multiValued="false" />
    <field name="is_sample"             type="boolean"   docValues="false" indexed="true" stored="true" multiValued="false" />
    <field name="image"                 type="string"    docValues="false" indexed="false" stored="true" multiValued="false" />
    <field name="identity_created_date" type="date"      docValues="false" indexed="false" stored="true" multiValued="false" />
    <field name="cluster_id"            type="int"       docValues="false" indexed="false" stored="true" multiValued="false" />
    <field name="rnd_cluster_processing_time" type="date" docValues="false" indexed="false" stored="true" multiValued="false" />
    <field name="sentiment_rule"        type="int"       docValues="false" indexed="true" stored="true" multiValued="false" />
    <field name="_version_"             type="long"      indexed="true" stored="true" multiValued="false"/>
    <dynamicField name="random_*"       type="random"    indexed="true" />
    <field name="language"              type="int"       docValues="false" indexed="true" stored="true" multiValued="false" />
    <field name="search_text_cloud" 
          type="text_cloud" 
          indexed="true" 
          stored="false" 
          multiValued="true"/>
  </fields>
  <uniqueKey>id</uniqueKey>
  <copyField name="search_text_exactly" source="search_text" dest="search_text_exactly"  />
  <copyField name="effect_exactly" source="effect" dest="effect_exactly"  />
  <copyField name="sound_exactly" source="sound" dest="sound_exactly"  />
  <copyField source="search_text" dest="search_text_cloud"/>

  <types>
    <fieldType name="uuid" class="solr.UUIDField" indexed="true" />
    <fieldType name="string" class="solr.StrField"   sortMissingLast="true" />
    <fieldType name="boolean" class="solr.BoolField"  sortMissingLast="true"/>
    <fieldType name="int" class="solr.IntPointField"   positionIncrementGap="0"/>
    <fieldType name="float" class="solr.FloatPointField"   positionIncrementGap="0"/>
    <fieldType name="long" class="solr.LongPointField"   positionIncrementGap="0"/>
    <fieldType name="double" class="solr.DoublePointField"  positionIncrementGap="0"/>
    <fieldType name="date" class="solr.DatePointField"   positionIncrementGap="0"/>

    <fieldType name="text_vi" class="solr.TextField" positionIncrementGap="100">
      <analyzer type="index">
        <charFilter class="solr.HTMLStripCharFilterFactory"/>
        <tokenizer class="solr.WhitespaceTokenizerFactory"/>
        <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt" />
        <filter class="solr.WordDelimiterGraphFilterFactory"
                splitOnCaseChange="0"
                splitOnNumerics="0"
                stemEnglishPossessive="1"
                generateWordParts="0"
                generateNumberParts="0"
                catenateWords="1"
                catenateNumbers="0"
                catenateAll="1"
                preserveOriginal="1"
        />
        <filter class="solr.LowerCaseFilterFactory"/>
        <filter class="solr.ASCIIFoldingFilterFactory"/>
      </analyzer>
      <analyzer type="query">
        <charFilter class="solr.HTMLStripCharFilterFactory"/>
        <tokenizer class="solr.WhitespaceTokenizerFactory"/>
        <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt" />
        <filter class="solr.WordDelimiterGraphFilterFactory"
                splitOnCaseChange="0"
                splitOnNumerics="0"
                stemEnglishPossessive="0"
                generateWordParts="0"
                generateNumberParts="0"
                catenateWords="0"
                catenateNumbers="0"
                catenateAll="1"
                preserveOriginal="1"
                protected="protwords.txt"
                types="wdfftypes.txt"
        />
        <filter class="solr.LowerCaseFilterFactory"/>
        <filter class="solr.ASCIIFoldingFilterFactory"/>
      </analyzer>
    </fieldType>
    <fieldType name="text_vi_exactly" class="solr.TextField" positionIncrementGap="100">
      <analyzer type="index">
        <charFilter class="solr.HTMLStripCharFilterFactory"/>
        <tokenizer class="solr.WhitespaceTokenizerFactory"/>
        <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt" />
        <filter class="solr.WordDelimiterGraphFilterFactory"
                splitOnCaseChange="0"
                splitOnNumerics="0"
                stemEnglishPossessive="1"
                generateWordParts="0"
                generateNumberParts="0"
                catenateWords="1"
                catenateNumbers="0"
                catenateAll="1"
                preserveOriginal="1"
        />
        <filter class="solr.LowerCaseFilterFactory"/>
      </analyzer>
      <analyzer type="query" >
        <charFilter class="solr.HTMLStripCharFilterFactory"/>
        <tokenizer class="solr.WhitespaceTokenizerFactory"/>
        <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt" />
        <filter class="solr.WordDelimiterGraphFilterFactory"
                splitOnCaseChange="0"
                splitOnNumerics="0"
                stemEnglishPossessive="0"
                generateWordParts="0"
                generateNumberParts="0"
                catenateWords="0"
                catenateNumbers="0"
                catenateAll="1"
                preserveOriginal="1"
                protected="protwords.txt"
                types="wdfftypes.txt"
        />
        <filter class="solr.LowerCaseFilterFactory"/>
      </analyzer>
    </fieldType>
    <fieldType name="text_cloud" class="solr.TextField" positionIncrementGap="100">
      <analyzer type="index">
        <charFilter class="solr.HTMLStripCharFilterFactory"/>
        <tokenizer class="solr.WhitespaceTokenizerFactory"/>
        <!-- Dùng file stopwords tiếng Việt riêng để loại từ dừng tốt hơn -->
        <filter class="solr.StopFilterFactory" 
                ignoreCase="true" 
                words="stopwords.txt"/>
        <!-- Loại bỏ empty strings TRƯỚC: thay empty string bằng giá trị 1 ký tự sẽ bị loại bỏ bởi LengthFilter -->
        <filter class="solr.PatternReplaceFilterFactory"
                pattern="^$"
                replacement="X"/>
        <!-- Loại bỏ các tokens có chứa dấu phẩy hoặc dấu gạch dưới -->
        <filter class="solr.PatternReplaceFilterFactory"
                pattern=".*[,;_].*"
                replacement=""/>
        <filter class="solr.LowerCaseFilterFactory"/>
        <!-- KHÔNG dùng ASCIIFoldingFilterFactory để giữ nguyên dấu tiếng Việt -->
        <!-- Loại bỏ các tokens quá ngắn (ít hơn 2 ký tự) - sẽ loại bỏ token "x" từ empty string -->
        <filter class="solr.LengthFilterFactory" min="2" max="50"/>
        
        <!-- Tạo shingles (cụm từ) từ 2 đến 4 từ, KHÔNG tạo từ đơn -->
        <filter class="solr.ShingleFilterFactory"
                minShingleSize="2"
                maxShingleSize="4"
                outputUnigrams="false"
                tokenSeparator=" "/>
        
        <!-- Loại bỏ các cụm từ quá ngắn (ít hơn 4 ký tự) hoặc quá dài -->
        <filter class="solr.LengthFilterFactory" min="4" max="50"/>
        <!-- Loại bỏ các cụm từ có chứa dấu phẩy hoặc dấu gạch dưới -->
        <filter class="solr.PatternReplaceFilterFactory"
                pattern=".*[,;_].*"
                replacement=""/>
        <!-- Loại bỏ empty strings sau PatternReplaceFilter: thay bằng giá trị 1 ký tự -->
        <filter class="solr.PatternReplaceFilterFactory"
                pattern="^$"
                replacement="X"/>
        <!-- LengthFilter sẽ loại bỏ token "x" (1 ký tự) -->
        <filter class="solr.LengthFilterFactory" min="2" max="50"/>
      </analyzer>
      <analyzer type="query">
        <!-- Query analyzer đơn giản hơn để tăng tốc faceting -->
        <charFilter class="solr.HTMLStripCharFilterFactory"/>
        <tokenizer class="solr.WhitespaceTokenizerFactory"/>
        <filter class="solr.StopFilterFactory" 
                ignoreCase="true" 
                words="stopwords.txt"/>
        <!-- Loại bỏ empty strings TRƯỚC -->
        <filter class="solr.PatternReplaceFilterFactory"
                pattern="^$"
                replacement="X"/>
        <filter class="solr.PatternReplaceFilterFactory"
                pattern=".*[,;_].*"
                replacement=""/>
        <filter class="solr.LowerCaseFilterFactory"/>
        <!-- KHÔNG dùng ASCIIFoldingFilterFactory để giữ nguyên dấu tiếng Việt -->
        <!-- LengthFilter sẽ loại bỏ token "x" (1 ký tự) từ empty string -->
        <filter class="solr.LengthFilterFactory" min="2" max="50"/>
        <!-- Tạo shingles từ query để match với index -->
        <filter class="solr.ShingleFilterFactory"
                minShingleSize="2"
                maxShingleSize="4"
                outputUnigrams="false"
                tokenSeparator=" "/>
        <filter class="solr.LengthFilterFactory" min="4" max="50"/>
        <filter class="solr.PatternReplaceFilterFactory"
                pattern=".*[,;:!?;_].*"
                replacement=""/>
        <!-- Loại bỏ empty strings sau PatternReplaceFilter: thay bằng giá trị 1 ký tự -->
        <filter class="solr.PatternReplaceFilterFactory"
                pattern="^$"
                replacement="X"/>
        <!-- LengthFilter sẽ loại bỏ token "x" (1 ký tự) -->
        <filter class="solr.LengthFilterFactory" min="2" max="50"/>
      </analyzer>
    </fieldType>
    <fieldType name="random" class="solr.RandomSortField" indexed="true" />
  </types>
</schema>
